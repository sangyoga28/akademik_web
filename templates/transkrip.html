{% extends "base.html" %}

{% block title %}Transkrip Nilai - {{ mahasiswa['nama'] }}{% endblock %}

{% block content_container %}
<style>
    /* Print Styles */
    @media print {

        /* Hide everything from base.html and non-essential elements */
        body,
        html {
            background: white !important;
            margin: 0 !important;
            padding: 0 !important;
        }

        .no-print,
        .navbar,
        .main-footer,
        .btn,
        .breadcrumb,
        .flash-messages,
        .btn-primary {
            display: none !important;
        }

        /* Reset the layout for print */
        .transcript-container {
            width: 100% !important;
            max-width: none !important;
            margin: 0 !important;
            padding: 0 !important;
            border: none !important;
            box-shadow: none !important;
        }

        .container,
        .container-fluid {
            padding: 0 !important;
            margin: 0 !important;
            max-width: none !important;
        }

        .semester-section {
            page-break-inside: avoid;
            margin-bottom: 20px;
        }

        .print-header {
            display: block !important;
        }

        .card {
            border: none !important;
            box-shadow: none !important;
        }

        .table {
            border-color: #000 !important;
        }

        .table-primary-header {
            background-color: #f8f9fa !important;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }

        @page {
            size: A4;
            margin: 10mm 15mm;
        }
    }

    /* Web Styling */
    .transcript-container {
        max-width: 1000px;
        margin: 2rem auto;
        padding: 0 1rem;
    }

    .print-header {
        display: none;
        border-bottom: 2px solid #000;
        padding-bottom: 10px;
        margin-bottom: 25px;
    }

    .transcript-table thead th {
        background-color: #2c3e50;
        /* Primary color but darker for contrast */
        color: white;
    }

    .semester-header {
        background-color: #f8f9fa;
        border-left: 5px solid #2c3e50;
        padding: 12px 20px;
        margin-top: 35px;
        margin-bottom: 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    }
</style>

<div class="transcript-container">
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    <div class="flash-messages no-print">
        {% for category, message in messages %}
        <div class="alert alert-{{ category }} alert-dismissible fade show shadow-sm" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endfor %}
    </div>
    {% endif %}
    {% endwith %}

    <!-- Official Header for Print -->
    <div class="print-header text-center">
        <h2 class="fw-bold mb-1">TRANSKRIP AKADEMIK</h2>
        <h5 class="mb-0">Universitas Sistem Informasi Akademik</h5>
        <hr>
    </div>

    <div class="row mb-4 align-items-center no-print">
        <div class="col-8">
            <h1 class="display-6 mb-0 fw-bold"><i class="bi bi-journal-text text-primary"></i> Transkrip Akademik</h1>
            <p class="text-muted mb-0">Rekapitulasi seluruh hasil studi mahasiswa.</p>
        </div>
        <div class="col-4 text-end">
            <button onclick="window.print()" class="btn btn-primary shadow-sm px-4 py-2">
                <i class="bi bi-printer me-2"></i> Cetak Transkrip
            </button>
        </div>
    </div>

    <!-- Student Info Card -->
    <div class="card shadow-sm border-0 mb-4 bg-white overflow-hidden">
        <div class="card-body p-4">
            <div class="row align-items-center">
                <div class="col-md-7">
                    <table class="table table-sm table-borderless mb-0">
                        <tr>
                            <td width="35%" class="text-muted small text-uppercase fw-bold">Nama Lengkap</td>
                            <td class="fw-bold fs-5">: {{ mahasiswa['nama'] }}</td>
                        </tr>
                        <tr>
                            <td class="text-muted small text-uppercase fw-bold">Nomor Induk (NIM)</td>
                            <td class="fw-bold font-monospace">: {{ mahasiswa['nim'] }}</td>
                        </tr>
                        <tr>
                            <td class="text-muted small text-uppercase fw-bold">Program Studi</td>
                            <td class="fw-bold">: {{ mahasiswa['prodi'] }}</td>
                        </tr>
                        {% if mahasiswa['fakultas'] %}
                        <tr>
                            <td class="text-muted small text-uppercase fw-bold">Fakultas</td>
                            <td class="fw-bold">: {{ mahasiswa['fakultas'] }}</td>
                        </tr>
                        {% endif %}
                    </table>
                </div>
                <div class="col-md-5 text-md-end mt-4 mt-md-0">
                    <div class="p-3 px-4 rounded-4 bg-primary text-white d-inline-block shadow">
                        <div class="small text-uppercase fw-bold mb-1 text-center" style="opacity: 0.8;">IPK Kumulatif
                        </div>
                        <div class="h1 mb-0 fw-bold">{{ "{:.2f}".format(ipk) }}</div>
                        <div class="small fw-bold text-center mt-1 border-top pt-1" style="opacity: 0.8;">Total {{
                            total_sks }} SKS</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Transcript Body -->
    <div class="transcript-content">
        {% for sem, data in transkrip_per_semester.items() %}
        <div class="semester-section">
            <div class="semester-header rounded-3 border">
                <h5 class="mb-0 fw-bold text-primary">SEMESTER {{ sem }}</h5>
                <div class="d-flex gap-4 small fw-bold">
                    <span class="text-muted">SKS: <span class="text-dark">{{ data['sks_semester'] }}</span></span>
                    <span class="text-muted">IPS: <span class="text-success">{{ "{:.2f}".format(data['ips'])
                            }}</span></span>
                </div>
            </div>

            <div class="table-responsive">
                <table class="table table-bordered transcript-table bg-white">
                    <thead class="small">
                        <tr class="align-middle text-center">
                            <th width="5%">NO</th>
                            <th width="15%">KODE</th>
                            <th width="50%" class="text-start ps-3">MATA KULIAH</th>
                            <th width="10%">SKS</th>
                            <th width="10%">NILAI</th>
                            <th width="10%">BOBOT</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for mk in data['matkul'] %}
                        <tr class="align-middle text-center">
                            <td>{{ loop.index }}</td>
                            <td class="font-monospace small text-primary">{{ mk['kode_matkul'] }}</td>
                            <td class="text-start ps-3">{{ mk['nama_matkul'] }}</td>
                            <td>{{ mk['sks'] }}</td>
                            <td class="fw-bold text-dark">{{ mk['nilai_huruf'] or '-' }}</td>
                            <td>{{ mk['bobot'] }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                    <tfoot class="table-light no-print">
                        <tr class="font-monospace small">
                            <td colspan="3" class="text-end fw-bold py-2">Total Semester {{ sem }}:</td>
                            <td class="text-center fw-bold py-2">{{ data['sks_semester'] }} SKS</td>
                            <td colspan="2" class="text-center fw-bold text-primary py-2">IPS: {{
                                "{:.2f}".format(data['ips']) }}</td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Official Footer for Print -->
    <div class="print-footer mt-5 pt-4 border-top">
        <div class="row justify-content-end">
            <div class="col-5 col-print-4 text-center">
                <p class="mb-5">Tangerang, {{ current_date or "23 Desember 2025" }}<br>Ketua Program Studi,</p>
                <div class="my-5 py-2"></div>
                <p class="fw-bold mb-0 text-decoration-underline text-uppercase" style="letter-spacing: 1px;">(
                    ................................ )</p>
                <p class="small text-muted font-monospace">NIP. ..........................</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}