{% extends "base.html" %}

{% block title %}Transkrip Nilai{% endblock %}

{% block content %}
<style>
    /* Print Styles */
    @media print {

        .no-print,
        .navbar,
        .main-footer,
        .btn,
        .breadcrumb {
            display: none !important;
        }

        body {
            background-color: white !important;
            padding: 0;
            margin: 0;
        }

        .container {
            width: 100% !important;
            max-width: none !important;
            padding: 0 !important;
            margin: 0 !important;
        }

        .card {
            border: none !important;
            box-shadow: none !important;
        }

        .accordion-item {
            border: none !important;
            margin-bottom: 20px;
        }

        .accordion-button {
            display: none !important;
        }

        .accordion-collapse {
            display: block !important;
            height: auto !important;
            visibility: visible !important;
        }

        .print-header {
            display: block !important;
            text-align: center;
            border-bottom: 2px solid #000;
            margin-bottom: 20px;
            padding-bottom: 10px;
        }

        .table-primary-header {
            background-color: #f8f9fa !important;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }

        @page {
            size: A4;
            margin: 15mm;
        }
    }

    /* Web Styles for visibility */
    .print-header {
        display: none;
    }

    .transcript-table thead th {
        background-color: var(--bs-primary);
        color: white;
    }

    .semester-header {
        background-color: #f8f9fa;
        border-left: 4px solid var(--bs-primary);
        padding: 10px 15px;
        margin-top: 30px;
        margin-bottom: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
</style>

<div class="container py-4">
    <!-- Official Header for Print -->
    <div class="print-header text-center mb-4">
        <h2 class="fw-bold mb-1">TRANSKRIP AKADEMIK</h2>
        <h5 class="mb-0">Universitas Sistem Informasi Akademik</h5>
        <hr>
    </div>

    <div class="row mb-4 align-items-center no-print">
        <div class="col-md-6">
            <h1 class="display-6 mb-0"><i class="bi bi-journal-text text-primary"></i> Transkrip Akademik</h1>
            <p class="text-muted">Rekapitulasi seluruh hasil studi mahasiswa.</p>
        </div>
        <div class="col-md-6 text-md-end">
            <button onclick="window.print()" class="btn btn-primary">
                <i class="bi bi-printer"></i> Cetak Transkrip
            </button>
        </div>
    </div>

    <!-- Student Info Card -->
    <div class="card shadow-sm border-0 mb-4 bg-white">
        <div class="card-body p-4">
            <div class="row">
                <div class="col-md-7">
                    <table class="table table-sm table-borderless mb-0">
                        <tr>
                            <td width="30%" class="text-muted small text-uppercase fw-bold">Nama Lengkap</td>
                            <td class="fw-bold">: {{ mahasiswa['nama'] }}</td>
                        </tr>
                        <tr>
                            <td class="text-muted small text-uppercase fw-bold">Nomor Induk (NIM)</td>
                            <td class="fw-bold font-monospace">: {{ mahasiswa['nim'] }}</td>
                        </tr>
                        <tr>
                            <td class="text-muted small text-uppercase fw-bold">Program Studi</td>
                            <td class="fw-bold">: {{ mahasiswa['prodi'] }}</td>
                        </tr>
                        {% if mahasiswa['fakultas'] %}
                        <tr>
                            <td class="text-muted small text-uppercase fw-bold">Fakultas</td>
                            <td class="fw-bold">: {{ mahasiswa['fakultas'] }}</td>
                        </tr>
                        {% endif %}
                    </table>
                </div>
                <div class="col-md-5 text-md-end mt-3 mt-md-0">
                    <div class="p-3 rounded-3 bg-light d-inline-block border">
                        <div class="small text-muted text-uppercase fw-bold mb-1 text-center">IPK Kumulatif</div>
                        <div class="h2 mb-0 fw-bold text-primary">{{ "{:.2f}".format(ipk) }}</div>
                        <div class="small fw-bold text-center mt-1">Total: {{ total_sks }} SKS</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Transcript Body -->
    <div class="transcript-content">
        {% for sem, data in transkrip_per_semester.items() %}
        <div class="semester-section mb-4">
            <div class="semester-header rounded-2 border shadow-sm">
                <h5 class="mb-0 fw-bold text-primary">Semester {{ sem }}</h5>
                <div class="d-flex gap-3 small fw-bold">
                    <span>SKS: {{ data['sks_semester'] }}</span>
                    <span class="text-success">IPS: {{ "{:.2f}".format(data['ips']) }}</span>
                </div>
            </div>

            <div class="table-responsive">
                <table class="table table-bordered transcript-table bg-white">
                    <thead class="table-light small">
                        <tr class="text-center">
                            <th width="5%">No</th>
                            <th width="15%">Kode</th>
                            <th width="50%" class="text-start">Mata Kuliah</th>
                            <th width="10%">SKS</th>
                            <th width="10%">Nilai</th>
                            <th width="10%">Point</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for mk in data['matkul'] %}
                        <tr class="align-middle text-center">
                            <td>{{ loop.index }}</td>
                            <td class="font-monospace small">{{ mk['kode_matkul'] }}</td>
                            <td class="text-start">{{ mk['nama_matkul'] }}</td>
                            <td>{{ mk['sks'] }}</td>
                            <td class="fw-bold">{{ mk['nilai_huruf'] or '-' }}</td>
                            <td>{{ mk['bobot'] }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                    <tfoot class="table-light no-print">
                        <tr class="font-monospace small">
                            <td colspan="3" class="text-end fw-bold">Jumlah Semester Ini:</td>
                            <td class="text-center fw-bold">{{ data['sks_semester'] }}</td>
                            <td colspan="2" class="text-center fw-bold text-primary">IPS: {{
                                "{:.2f}".format(data['ips']) }}</td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Official Footer for Print -->
    <div class="print-footer mt-5 pt-4 border-top">
        <div class="row justify-content-end">
            <div class="col-4 text-center">
                <p class="mb-5">Tangerang, {{ current_date or "23 Desember 2025" }}<br>Ketua Program Studi,</p>
                <br><br>
                <p class="fw-bold mb-0 text-decoration-underline">( ................................ )</p>
                <p class="small text-muted font-monospace">NIP. ..........................</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}